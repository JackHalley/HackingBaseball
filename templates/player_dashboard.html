<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>

<div class="form-group">
    <label for="statsSelect">Select Stats:</label>
    <select id="statsSelect" multiple class="form-control">
        <!-- Options will be populated dynamically with JavaScript -->
    </select>
</div>

    <div class="container">
        <h1 class="mt-5">Player Performance Dashboard</h1>
        <div class="my-3">
            <label for="yearSelect">Select Year:</label>
            <select id="yearSelect" class="form-control">
                {% for year in range(2010, 2023) %}
                <option value="{{ year }}">{{ year }}</option>
                {% endfor %}
            </select>
        </div>
        <table class="table" id="playerData">
            <thead class="thead-dark">
                <tr>
                    <th>Name</th>
                    <th>Team</th>
                    <th>Home Runs</th>
                    <th>Batting Average</th>
                </tr>
            </thead>
            <tbody>
                <!-- Data will be inserted here -->
            </tbody>
        </table>
    </div>
<script>
    function fetchData(year, selectedStats) {
    console.log(selectedStats)
        $.ajax({
            url: '/filter_data',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ filters: { year: year }, selectedStats: selectedStats }),
            success: function(data) {
                console.log(data)
                var rows = '';
                $.each(data, function(index, player) {
                    var playerRow = `<tr>`;
                    $.each(selectedStats, function(i, stat) {
                        playerRow += `<td>${player[stat]}</td>`; // Use stat.toLowerCase() to match JSON keys
                    });
                    playerRow += `</tr>`;
                    rows += playerRow;
                });
                $('#playerData tbody').html(rows);
            },
            error: function(xhr, status, error) {
                console.error("Error fetching data: ", status, error);
            }
        });
    }

  $(document).ready(function() {
    // Fetch available stats and populate the selection menu
    $.getJSON('/available_stats', function(stats) {
        var statsSelect = $('#statsSelect');
        stats.forEach(function(stat) {
            statsSelect.append($('<option>', {
                value: stat,
                text: stat
            }));
        });
    });

    // Placeholder array for selected stats, this will be updated based on actual user selection
    var selectedStats = [];

    // Fetch data when the page loads and on year or stats selection changes
    $('#yearSelect, #statsSelect').change(function() {
        selectedStats = $('#statsSelect').val(); // Update selected stats based on user selection
        fetchData($('#yearSelect').val(), selectedStats);
    });

    // Trigger change event to load initial data
    $('#yearSelect').change();
});
</script>


    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
</body>
</html>
